#!/usr/bin/env python3
"""
Simple YAML parser fallback for when yq is not available
Usage: yq_fallback '.path.to.field' file.yaml
"""

import sys
import yaml
import json

def main():
    if len(sys.argv) != 3:
        print("Usage: yq_fallback '.path.to.field' file.yaml", file=sys.stderr)
        sys.exit(1)

    query = sys.argv[1]
    filepath = sys.argv[2]

    try:
        with open(filepath, 'r') as f:
            content = f.read()

        # Extract YAML frontmatter if present (between --- markers)
        if content.startswith('---'):
            parts = content.split('---', 2)
            if len(parts) >= 3:
                yaml_content = parts[1]
            else:
                yaml_content = parts[1] if len(parts) > 1 else content
        else:
            yaml_content = content

        data = yaml.safe_load(yaml_content)

        # Simple path navigation (e.g., '.routing.tiers.x1')
        path = query.strip('.').split('.')
        current = data

        for segment in path:
            if isinstance(current, dict) and segment in current:
                current = current[segment]
            else:
                print("null", file=sys.stderr)
                sys.exit(1)

        # Output result
        if isinstance(current, list):
            for item in current:
                print(item)
        else:
            print(current)

    except Exception as e:
        print(f"Error: {e}", file=sys.stderr)
        sys.exit(1)

if __name__ == "__main__":
    main()